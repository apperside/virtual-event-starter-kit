--- node_modules/next-auth/dist/server/lib/callback-handler.js	2021-06-18 09:28:54.000000000 +0200
+++ patches/next-auth/dist/server/lib/callback-handler.js	2021-06-18 18:20:41.000000000 +0200
@@ -43,7 +43,8 @@
     linkAccount,
     createSession,
     getSession,
-    deleteSession
+    deleteSession,
+    forceLinkAccount
   } = (0, _errorHandler.default)(await adapter.getAdapter(options), options.logger);
   let session = null;
   let user = null;
@@ -57,7 +58,8 @@
       try {
         var _session;
 
-        session = await jwt.decode({ ...jwt,
+        session = await jwt.decode({
+          ...jwt,
           token: sessionToken
         });
 
@@ -65,7 +67,7 @@
           user = await getUser(session.sub);
           isSignedIn = !!user;
         }
-      } catch (_unused) {}
+      } catch (_unused) { }
     }
 
     session = await getSession(sessionToken);
@@ -87,13 +89,15 @@
       }
 
       const currentDate = new Date();
-      user = await updateUser({ ...userByEmail,
+      user = await updateUser({
+        ...userByEmail,
         emailVerified: currentDate
       });
       await (0, _dispatchEvent.default)(events.updateUser, user);
     } else {
       const currentDate = new Date();
-      user = await createUser({ ...profile,
+      user = await createUser({
+        ...profile,
         emailVerified: currentDate
       });
       await (0, _dispatchEvent.default)(events.createUser, user);
@@ -145,7 +149,13 @@
       const userByEmail = profile.email ? await getUserByEmail(profile.email) : null;
 
       if (userByEmail) {
-        throw new _errors.AccountNotLinkedError();
+        // throw new _errors.AccountNotLinkedError();
+        /**
+         * If found by email, link user.
+         * THIS IS NOT SAFE as stated here https://github.com/nextauthjs/next-auth/pull/1002
+         * but improves user experience
+         */
+        await linkAccount(userByEmail.id, providerAccount.provider, providerAccount.type, providerAccount.id, providerAccount.refreshToken, providerAccount.accessToken, providerAccount.accessTokenExpires);
       }
 
       user = await createUser(profile);
